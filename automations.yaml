#                _                        _   _
#     /\        | |                      | | (_)
#    /  \  _   _| |_ ___  _ __ ___   __ _| |_ _  ___  _ __
#   / /\ \| | | | __/ _ \| '_ ` _ \ / _` | __| |/ _ \| '_ \
#  / ____ \ |_| | || (_) | | | | | | (_| | |_| | (_) | | | |
# /_/    \_\__,_|\__\___/|_| |_| |_|\__,_|\__|_|\___/|_| |_|
# https://www.home-assistant.io/components/automation/
# https://www.home-assistant.io/docs/automation/examples/
# https://www.home-assistant.io/cookbook/

#     __            _ _         _____  _
#    /_/           | (_)       |  __ \| |
#    / \  _   _  __| |_  ___   | |__) | | __ _ _   _  ___ _ __
#   / _ \| | | |/ _` | |/ _ \  |  ___/| |/ _` | | | |/ _ \ '__|
#  / ___ \ |_| | (_| | | (_) | | |    | | (_| | |_| |  __/ |
# /_/   \_\__,_|\__,_|_|\___/  |_|    |_|\__,_|\__, |\___|_|
#                                               __/ |
#                                              |___/
# Controle do volume
- alias: Ajusta Volume do Player de Audio
  initial_state: true
  trigger:
  - platform: state
    entity_id: input_number.audio_volume
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: >
        {% if is_state("input_select.src_cast_audio", "Google Home Quarto") %} media_player.google_home
        {% elif is_state("input_select.src_cast_audio", "Google Home Sala") %} media_player.google_home_sala
        {% elif is_state("input_select.src_cast_audio", "Todos Google Homes") %} media_player.todos_google_homes
        {% elif is_state("input_select.src_cast_audio", "Chromecast Tv Sala") %} media_player.tv_da_sala
        {% elif is_state("input_select.src_cast_audio", "Chromecast Tv Quarto") %} media_player.tv_do_quarto
        {% endif %}
      volume_level: '{{  states.input_number.audio_volume.state  }}'

# __      ____    _              _____  _
# \ \    / /_/   | |            |  __ \| |
#  \ \  / / _  __| | ___  ___   | |__) | | __ _ _   _  ___ _ __
#   \ \/ / | |/ _` |/ _ \/ _ \  |  ___/| |/ _` | | | |/ _ \ '__|
#    \  /  | | (_| |  __/ (_) | | |    | | (_| | |_| |  __/ |
#     \/   |_|\__,_|\___|\___/  |_|    |_|\__,_|\__, |\___|_|
#                                                __/ |
#                                               |___/
# Controle do volume
- alias: Ajusta Volume do Player de Video
  initial_state: true
  trigger:
  - platform: state
    entity_id: input_number.video_volume
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: >
        {% if is_state("input_select.src_cast_video", "Quarto") %} media_player.tv_do_quarto
        {% elif is_state("input_select.src_cast_video", "Sala") %} media_player.tv_da_sala
        {% endif %}
      volume_level: '{{  states.input_number.video_volume.state  }}'

- alias: Ajusta Volume do Player Streaming
  initial_state: true
  trigger:
  - platform: state
    entity_id: input_number.volume_media_extractor
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: >
        {% if is_state("input_select.src_cast_video", "Quarto") %} media_player.google_home
        {% elif is_state("input_select.src_cast_video", "Sala") %} media_player.google_home_sala
        {% endif %}
      volume_level: '{{  states.input_number.volume_media_extractor.state  }}'

#  _____                              _          _         ______                             _
# |  __ \                            | |        | |       |  ____|                           | |
# | |__) |___ _ __   _____   ____ _  | |     ___| |_ ___  | |__   _ __   ___ _ __ _   _ _ __ | |_
# |  _  // _ \ '_ \ / _ \ \ / / _` | | |    / _ \ __/ __| |  __| | '_ \ / __| '__| | | | '_ \| __|
# | | \ \  __/ | | | (_) \ V / (_| | | |___|  __/ |_\__ \ | |____| | | | (__| |  | |_| | |_) | |_
# |_|  \_\___|_| |_|\___/ \_/ \__,_| |______\___|\__|___/ |______|_| |_|\___|_|   \__, | .__/ \__|
#                                                                                 |___/|_|
- id: letsencrypt-renewal
  initial_state: true
  alias: "Renova Let's Encrypt"
  trigger:
  - platform: time
    at: '00:00:00'
  action:
  - service: hassio.addon_restart
    data:
      addon: core_letsencrypt


#   _____            _             _            __      __
#  / ____|          | |           | |           \ \    /_ |
# | |     ___  _ __ | |_ _ __ ___ | | ___   _____\ \    | |
# | |    / _ \| '_ \| __| '__/ _ \| |/ _ \ |______> >   | |
# | |___| (_) | | | | |_| | | (_) | |  __/       / /    | |
#  \_____\___/|_| |_|\__|_|  \___/|_|\___|      /_/     |_|
#
# BOTAO ARMAR
- alias: Controle (1) - Armar
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.c1_armar
    from: 'off'
    to: 'on'
  action:
  - service: switch.turn_on
    data:
      entity_id: switch.seguranca_casa

# BOTAO DESARMAR
- alias: Controle (1) - Desarmar
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.c1_desarmar
    from: 'off'
    to: 'on'
  action:
  - service: switch.turn_off
    data:
      entity_id: switch.seguranca_casa

# HOME (Liga luz Poste se estiver off)
- alias: Controle (1) - Bt Home (Liga Poste)
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.c1_home
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_dos_postes
    state: 'off'
  action:
  - service: light.turn_on
    data:
      entity_id: 
        - light.luz_dos_postes
        - light.luz_da_area_da_piscina

# HOME (Desliga luz Poste se estiver on)
- alias: Controle (1) - Bt Home (Desligar Poste)
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.c1_home
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_dos_postes
    state: 'on'
  action:
  - service: light.turn_off
    data:
      entity_id: 
        - light.luz_dos_postes
        - light.luz_da_area_da_piscina

# SOS (Liga luz pendentes se estiver off)
- alias: Controle (1) - Bt SOS (Liga QM)
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.c1_sos
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_pendentes
    state: 'off'
  action:
  - service: light.turn_on
    data:
      entity_id: light.luz_pendentes

# SOS (Desliga luz pendentes se estiver on)
- alias: Controle (1) - Bt SOS (Desligar QM)
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.c1_sos
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_pendentes
    state: 'on'
  action:
  - service: light.turn_off
    data:
      entity_id: light.luz_pendentes


#   _____            _             _            __      ___
#  / ____|          | |           | |           \ \    |__ \
# | |     ___  _ __ | |_ _ __ ___ | | ___   _____\ \      ) |
# | |    / _ \| '_ \| __| '__/ _ \| |/ _ \ |______> >    / /
# | |___| (_) | | | | |_| | | (_) | |  __/       / /    / /_
#  \_____\___/|_| |_|\__|_|  \___/|_|\___|      /_/    |____|
#
# ARMAR
- alias: Controle (2) - Armar
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.c2_armar
    from: 'off'
    to: 'on'
  action:
  - service: switch.turn_on
    data:
      entity_id: switch.seguranca_casa

# DESARMAR
- alias: Controle (2) - Desarmar
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.c2_desarmar
    from: 'off'
    to: 'on'
  action:
  - service: switch.turn_off
    data:
      entity_id: switch.seguranca_casa

# HOME ( SEM FUNCAO)
- alias: Controle (2) - Btn Home
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.c2_home
    from: 'off'
    to: 'on'
  action:
  - service: notify.telegramrudi
    data:
      message: Botão Home pressinado em controle 2.
  - service_template: >
        {% if is_state("input_select.padrao_tts", "Google") %} tts.google_translate_say
        {% elif is_state("input_select.padrao_tts", "Voicerss") %} tts.voicerss_say
        {% elif is_state("input_select.padrao_tts", "Watson") %} tts.watson_tts_say
        {% elif is_state("input_select.padrao_tts", "Amazon") %} tts.amazon_polly_say
        {% endif %}
    data_template:
      entity_id: media_player.todos_google_homes
      message: Home pressinado em controle 2.

# SOS ( SEM FUNCAO)
- alias: Controle (2) - Btn SOS
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.c2_sos
    from: 'off'
    to: 'on'
  action:
  - service: notify.telegramrudi
    data:
      message: Botão SOS pressinado em controle 2.
  - service_template: >
        {% if is_state("input_select.padrao_tts", "Google") %} tts.google_translate_say
        {% elif is_state("input_select.padrao_tts", "Voicerss") %} tts.voicerss_say
        {% elif is_state("input_select.padrao_tts", "Watson") %} tts.watson_tts_say
        {% elif is_state("input_select.padrao_tts", "Amazon") %} tts.amazon_polly_say
        {% endif %}
    data_template:
      entity_id: media_player.todos_google_homes
      message: SOS pressinado em controle 2.

#   _____            _             _            __      ____
#  / ____|          | |           | |           \ \    |___ \
# | |     ___  _ __ | |_ _ __ ___ | | ___   _____\ \     __) |
# | |    / _ \| '_ \| __| '__/ _ \| |/ _ \ |______> >   |__ <
# | |___| (_) | | | | |_| | | (_) | |  __/       / /    ___) |
#  \_____\___/|_| |_|\__|_|  \___/|_|\___|      /_/    |____/
# 

# ARMAR
- alias: Controle (3) - Armar
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.c3_armar
    from: 'off'
    to: 'on'
  action:
  - service: switch.turn_on
    data:
      entity_id: switch.seguranca_casa

# DESARMAR
- alias: Controle (3) - Desarmar
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.c3_desarmar
    from: 'off'
    to: 'on'
  action:
  - service: switch.turn_off
    data:
      entity_id: switch.seguranca_casa

# HOME (Liga luz do Abajur se estiver off)
- alias: Controle (3) - Bt Home (Liga abajur)
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.c3_home
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.yeelight_color1_7c49eb15924b
    state: 'off'
  action:
  - service: light.turn_on
    data:
      entity_id: light.yeelight_color1_7c49eb15924b
      transition: 3

# HOME (Desliga luz do Abajur se estiver on)
- alias: Controle (3) - Bt Home (Desligar abajur)
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.c3_home
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.yeelight_color1_7c49eb15924b
    state: 'on'
  action:
  - service: light.turn_off
    data:
      entity_id: light.yeelight_color1_7c49eb15924b
      transition: 3

# SOS (Liga luz do postes se estiver off)
- alias: Controle (3) - SOS Home (Liga Postes)
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.c3_sos
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_dos_postes
    state: 'off'
  action:
  - service: light.turn_on
    data:
      entity_id: 
        - light.luz_dos_postes
        - light.luz_da_area_da_piscina

# SOS (Desliga luz do postes se estiver on)
- alias: Controle (3) - Bt SOS (Desligar Postes)
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.c3_sos
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_dos_postes
    state: 'on'
  action:
  - service: light.turn_off
    data:
      entity_id: 
        - light.luz_dos_postes
        - light.luz_da_area_da_piscina


#  _____       _                             _                        _  _  ____ ____  __  __ _         
# |_   _|     | |                           | |                      | || ||___ \___ \|  \/  | |
#   | |  _ __ | |_ ___ _ __ _ __ _   _ _ __ | |_ ___  _ __ ___  ___  | || |_ __) |__) | \  / | |__  ____
#   | | | '_ \| __/ _ \ '__| '__| | | | '_ \| __/ _ \| '__/ _ \/ __| |__   _|__ <|__ <| |\/| | '_ \|_  /
#  _| |_| | | | ||  __/ |  | |  | |_| | |_) | || (_) | | |  __/\__ \    | | ___) |__) | |  | | | | |/ / 
# |_____|_| |_|\__\___|_|  |_|   \__,_| .__/ \__\___/|_|  \___||___/    |_||____/____/|_|  |_|_| |_/___|
#                                     |_|                                                               
# Cozinha - 2 Teclas
- alias: RF1 Cozinha On
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1_interruptor_coz
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_da_pia
    state: 'off'
  action:
  - service: light.turn_on
    data:
      entity_id: 
        - light.luz_da_pia
- alias: RF1 Cozinha Off
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1_interruptor_coz
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_da_pia
    state: 'on'
  action:
  - service: light.turn_off
    data:
      entity_id: 
        - light.luz_da_pia
- alias: RF2 Cozinha On
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf2_interruptor_coz
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: switch.pressurizador
    state: 'off'
  action:
  - service: switch.turn_on
    data:
      entity_id: switch.pressurizador
- alias: RF2 Cozinha Off
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf2_interruptor_coz
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: switch.pressurizador
    state: 'on'
  action:
  - service: switch.turn_off
    data:
      entity_id: switch.pressurizador
- alias: RF1e2 Cozinha On
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1e2_interruptor_coz
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_da_cozinha
    state: 'off'
  action:
  - service: light.turn_on
    data:
      entity_id: 
        - light.luz_da_cozinha
- alias: RF1e2 Cozinha Off
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1e2_interruptor_coz
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_da_cozinha
    state: 'on'
  action:
  - service: light.turn_off
    data:
      entity_id: 
        - light.luz_da_cozinha
#Banheiro da Suite - 2 Teclas
- alias: RF1 Banheiro Suite On
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1_interruptor_bsu
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_do_banheiro_da_suite
    state: 'off'
  action:
  - service: light.turn_on
    data:
      entity_id: 
        - light.luz_do_banheiro_da_suite
- alias: RF1 Banheiro Suite Off
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1_interruptor_bsu
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_do_banheiro_da_suite
    state: 'on'
  action:
  - service: light.turn_off
    data:
      entity_id: 
        - light.luz_do_banheiro_da_suite
- alias: RF2 Banheiro Suite On
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf2_interruptor_bsu
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: switch.pressurizador
    state: 'off'
  action:
  - service: switch.turn_on
    data:
      entity_id: switch.pressurizador
- alias: RF2 Banheiro Suite Off
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf2_interruptor_bsu
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: switch.pressurizador
    state: 'on'
  action:
  - service: switch.turn_off
    data:
      entity_id: switch.pressurizador
- alias: RF1e2 Banheiro Suite SOS
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1e2_interruptor_bsu
    from: 'off'
    to: 'on'
  action:
    - service: notify.telegramtodos
      data:
        message: "Alguém precisa de ajuda no banheiro da suíte!"
    - service: media_player.volume_set
      data_template:
        entity_id: media_player.google_home_sala
        volume_level: 0.9
    - service: media_player.volume_set
      data_template:
        entity_id: media_player.google_home
        volume_level: 0.9
    - service_template: >
          {% if is_state("input_select.padrao_tts", "Google") %} tts.google_translate_say
          {% elif is_state("input_select.padrao_tts", "Voicerss") %} tts.voicerss_say
          {% elif is_state("input_select.padrao_tts", "Watson") %} tts.watson_tts_say
          {% elif is_state("input_select.padrao_tts", "Amazon") %} tts.amazon_polly_say
          {% endif %}
      data_template:
        entity_id: media_player.todos_google_homes
        message: "Alguém precisa de ajuda no banheiro da suíte! Só pode que esqueceu a toalha ou ficou sem papel!"

#Banheiro Social - 2 Teclas
- alias: RF1 Banheiro Social On
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1_interruptor_bso
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_do_banheiro_social
    state: 'off'
  action:
  - service: light.turn_on
    data:
      entity_id: 
        - light.luz_do_banheiro_social
- alias: RF1 Banheiro Social Off
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1_interruptor_bso
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_do_banheiro_social
    state: 'on'
  action:
  - service: light.turn_off
    data:
      entity_id: 
        - light.luz_do_banheiro_social
- alias: RF2 Banheiro Social On
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf2_interruptor_bso
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: switch.pressurizador
    state: 'off'
  action:
  - service: switch.turn_on
    data:
      entity_id: switch.pressurizador
- alias: RF2 Banheiro Social Off
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf2_interruptor_bso
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: switch.pressurizador
    state: 'on'
  action:
  - service: switch.turn_off
    data:
      entity_id: switch.pressurizador
- alias: RF1e2 Banheiro Social SOS
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1e2_interruptor_bso
    from: 'off'
    to: 'on'
  action:
    - service: notify.telegramtodos
      data:
        message: "Alguém precisa de ajuda no banheiro social!"
    - service: media_player.volume_set
      data_template:
        entity_id: media_player.google_home_sala
        volume_level: 0.9
    - service: media_player.volume_set
      data_template:
        entity_id: media_player.google_home
        volume_level: 0.9
    - service_template: >
          {% if is_state("input_select.padrao_tts", "Google") %} tts.google_translate_say
          {% elif is_state("input_select.padrao_tts", "Voicerss") %} tts.voicerss_say
          {% elif is_state("input_select.padrao_tts", "Watson") %} tts.watson_tts_say
          {% elif is_state("input_select.padrao_tts", "Amazon") %} tts.amazon_polly_say
          {% endif %}
      data_template:
        entity_id: media_player.todos_google_homes
        message: "Alguém precisa de ajuda no banheiro social! Só pode que esqueceu a toalha ou ficou sem papel!"

# Quarto da Suite - 3 teclas
- alias: RF1 Interruptor Suite On
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1_interruptor_suite
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_da_suite
    state: 'off'
  action:
  - service: light.turn_on
    data:
      entity_id: light.luz_da_suite
- alias: RF1 Interruptor Suite Off
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1_interruptor_suite
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_da_suite
    state: 'on'
  action:
  - service: light.turn_off
    data:
      entity_id: light.luz_da_suite
- alias: RF2 Interruptor Suite On
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf2_interruptor_suite
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.yeelight_color1_7c49eb15924b
    state: 'off'
  action:
  - service: light.turn_on
    data:
      entity_id: light.yeelight_color1_7c49eb15924b
      transition: 5
- alias: RF2 Interruptor Suite Off
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf2_interruptor_suite
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.yeelight_color1_7c49eb15924b
    state: 'on'
  action:
  - service: light.turn_off
    data:
      entity_id: light.yeelight_color1_7c49eb15924b
      transition: 5
- alias: RF3 Interruptor Suite On
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf3_interruptor_suite
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_do_banheiro_da_suite
    state: 'off'
  action:
  - service: light.turn_on
    data:
      entity_id: light.luz_do_banheiro_da_suite
- alias: RF3 Interruptor Suite Off
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf3_interruptor_suite
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_do_banheiro_da_suite
    state: 'on'
  action:
  - service: light.turn_off
    data:
      entity_id: light.luz_do_banheiro_da_suite
- alias: RF1e3 Interruptor Suite On
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1e3_interruptor_suite
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_dos_postes
    state: 'off'
  action:
  - service: light.turn_on
    data:
      entity_id: light.luz_dos_postes
- alias: RF1e3 Interruptor Suite Off
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1e3_interruptor_suite
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_dos_postes
    state: 'on'
  action:
  - service: light.turn_off
    data:
      entity_id: light.luz_dos_postes
- alias: RF1e2 Interruptor Suite On Alarme
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1e2_interruptor_suite
    from: 'off'
    to: 'on'
  action:
  - service: switch.turn_on
    data:
      entity_id: switch.seguranca_casa
- alias: RF2e3 Interruptor Suite Off Alarme
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf2e3_interruptor_suite
    from: 'off'
    to: 'on'
  action:
  - service: switch.turn_off
    data:
      entity_id: switch.seguranca_casa

# Quarto da Q Frente - 3 teclas
# ON - light.luz_do_quarto_da_frente
- alias: RF1 Interruptor Q Frente On
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1_interruptor_quarto_frente
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_do_quarto_da_frente
    state: 'off'
  action:
  - service: light.turn_on
    data:
      entity_id: light.luz_do_quarto_da_frente
# OFF - light.luz_do_quarto_da_frente
- alias: RF1 Interruptor Q Frente Off
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1_interruptor_quarto_frente
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_do_quarto_da_frente
    state: 'on'
  action:
  - service: light.turn_off
    data:
      entity_id: light.luz_do_quarto_da_frente
# ON - light.luz_do_corredor
- alias: RF2 Interruptor Q Frente On
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf2_interruptor_quarto_frente
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_do_corredor
    state: 'off'
  action:
  - service: light.turn_on
    data:
      entity_id: light.luz_do_corredor
      transition: 5
# OFF - light.luz_do_corredor
- alias: RF2 Interruptor Q Frente Off
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf2_interruptor_quarto_frente
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_do_corredor
    state: 'on'
  action:
  - service: light.turn_off
    data:
      entity_id: light.luz_do_corredor
      transition: 5
# ON - light.luz_do_banheiro_social
- alias: RF3 Interruptor Q Frente On
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf3_interruptor_quarto_frente
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_do_quarto_da_frente
    state: 'off'
  action:
  - service: light.turn_on
    data:
      entity_id: light.luz_do_quarto_da_frente
# OFF - light.luz_do_banheiro_social
- alias: RF3 Interruptor Q Frente Off
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf3_interruptor_quarto_frente
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_do_quarto_da_frente
    state: 'on'
  action:
  - service: light.turn_off
    data:
      entity_id: light.luz_do_quarto_da_frente
- alias: RF1e3 Interruptor Q Frente SOS
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1e3_interruptor_quarto_frente
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_dos_postes
    state: 'off'
  action:
    - service: notify.telegramtodos
      data:
        message: "Alguém precisa de ajuda no quarto da frente!"
    - service: media_player.volume_set
      data_template:
        entity_id: media_player.google_home_sala
        volume_level: 0.9
    - service: media_player.volume_set
      data_template:
        entity_id: media_player.google_home
        volume_level: 0.9
    - service_template: >
          {% if is_state("input_select.padrao_tts", "Google") %} tts.google_translate_say
          {% elif is_state("input_select.padrao_tts", "Voicerss") %} tts.voicerss_say
          {% elif is_state("input_select.padrao_tts", "Watson") %} tts.watson_tts_say
          {% elif is_state("input_select.padrao_tts", "Amazon") %} tts.amazon_polly_say
          {% endif %}
      data_template:
        entity_id: media_player.todos_google_homes
        message: "Alguém precisa de ajuda no quarto da frente!"

- alias: RF1e2 Interruptor Q Frente On Alarme
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1e2_interruptor_quarto_frente
    from: 'off'
    to: 'on'
  action:
  - service: switch.turn_on
    data:
      entity_id: switch.seguranca_casa
- alias: RF2e3 Interruptor Q Frente Off Alarme
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf2e3_interruptor_quarto_frente
    from: 'off'
    to: 'on'
  action:
  - service: switch.turn_off
    data:
      entity_id: switch.seguranca_casa

# Quarto da Q Meio - 3 teclas
- alias: RF1 Interruptor Q Meio On
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1_interruptor_quarto_meio
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_do_quarto_do_meio
    state: 'off'
  action:
  - service: light.turn_on
    data:
      entity_id: light.luz_do_quarto_do_meio
- alias: RF1 Interruptor Q Meio Off
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf1_interruptor_quarto_meio
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_do_quarto_do_meio
    state: 'on'
  action:
  - service: light.turn_off
    data:
      entity_id: light.luz_do_quarto_do_meio
- alias: RF2 Interruptor Q Meio On
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf2_interruptor_quarto_meio
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_do_corredor
    state: 'off'
  action:
  - service: light.turn_on
    data:
      entity_id: light.luz_do_quarto_do_meio
#      transition: 5
- alias: RF2 Interruptor Q Meio Off
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.rf2_interruptor_quarto_meio
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_do_corredor
    state: 'on'
  action:
  - service: light.turn_off
    data:
      entity_id: light.luz_do_quarto_do_meio
#      transition: 5
#- alias: RF3 Interruptor Q Meio On
#  initial_state: true
#  trigger:
#  - platform: state
#    entity_id: binary_sensor.rf3_interruptor_quarto_meio
#    from: 'off'
#    to: 'on'
#  condition:
#    condition: state
#    entity_id: light.luz_do_banheiro_social
#    state: 'off'
#  action:
#  - service: light.turn_on
#    data:
#      entity_id: light.luz_do_banheiro_social
#- alias: RF3 Interruptor Q Meio Off
#  initial_state: true
#  trigger:
#  - platform: state
#    entity_id: binary_sensor.rf3_interruptor_quarto_meio
#    from: 'off'
#    to: 'on'
#  condition:
#    condition: state
#    entity_id: light.luz_do_banheiro_social
#    state: 'on'
#  action:
#  - service: light.turn_off
#    data:
#      entity_id: light.luz_do_banheiro_social
- alias: RF1e3 Interruptor Q Meio On
  initial_state: true
  trigger:
  - platform: state
#    entity_id: binary_sensor.rf1e3_interruptor_quarto_meio
    entity_id: binary_sensor.rf3_interruptor_quarto_meio
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: light.luz_dos_postes
    state: 'off'
  action:
    - service: notify.telegramtodos
      data:
        message: "Alguém precisa de ajuda no quarto do meio!"
    - service: media_player.volume_set
      data_template:
        entity_id: media_player.google_home_sala
        volume_level: 0.9
    - service: media_player.volume_set
      data_template:
        entity_id: media_player.google_home
        volume_level: 0.9
    - service_template: >
          {% if is_state("input_select.padrao_tts", "Google") %} tts.google_translate_say
          {% elif is_state("input_select.padrao_tts", "Voicerss") %} tts.voicerss_say
          {% elif is_state("input_select.padrao_tts", "Watson") %} tts.watson_tts_say
          {% elif is_state("input_select.padrao_tts", "Amazon") %} tts.amazon_polly_say
          {% endif %}
      data_template:
        entity_id: media_player.todos_google_homes
        message: "Alguém precisa de ajuda no quarto do meio!"

#- alias: RF1e2 Interruptor Q Meio On Alarme
#  initial_state: true
#  trigger:
#  - platform: state
#    entity_id: binary_sensor.rf1e2_interruptor_quarto_meio
#    from: 'off'
#    to: 'on'
#  action:
#  - service: switch.turn_on
#    data:
#      entity_id: switch.seguranca_casa
#- alias: RF2e3 Interruptor Q Meio Off Alarme
#  initial_state: true
#  trigger:
#  - platform: state
#    entity_id: binary_sensor.rf2e3_interruptor_quarto_meio
#    from: 'off'
#    to: 'on'
#  action:
#  - service: switch.turn_off
#    data:
#      entity_id: switch.seguranca_casa

#  _                 _   _       _   _  __
# | |               | \ | |     | | (_)/ _|
# | |    _   _ ____ |  \| | ___ | |_ _| |_
# | |   | | | |_  / | . ` |/ _ \| __| |  _|
# | |___| |_| |/ /  | |\  | (_) | |_| | |_
# |______\__,_/___| |_| \_|\___/ \__|_|_(_)
#
# Notifica se luz foi ligado/desligada e ninguem estiver em casa
- alias: 'Notificação: Luzez On/Off'
  initial_state: true
  trigger:
  - entity_id:
      - light.luz_da_garagem
      - light.luz_arandelas_principais
      - light.luz_arandelas_da_varanda
      - light.luz_da_area_da_piscina
      - light.refretores_piscina
      - light.luz_da_entrada
      - light.luz_varanda_fundos
      - light.luz_dos_postes
      - light.luz_da_lavanderia
      - light.luz_do_banheiro_da_suite
      - light.luz_do_banheiro_social
      - light.luz_do_lavabo
      - light.luz_da_cozinha
      - light.luz_da_pia
      - light.luz_do_bebedor
      - light.luz_pendentes
      - light.luz_sala_game
      - light.luz_central
      - light.luz_trilhos
      - light.luz_da_cabeceira
      - light.luz_jf
      - light.luz_da_entrada_garagem
      - light.luz_da_mesa_de_jantar
      - light.luz_do_lustre
      - light.luz_da_sala_de_estar
      - light.luz_do_quarto_da_frente
      - light.luz_do_quarto_do_meio
      - light.luz_do_corredor
      - light.luz_da_suite
      - light.yeelight_color1_7c49eb15924b
      - light.luz_do_closet
    from: 'off'
    platform: state
    to: 'on'
  - entity_id:
      - light.luz_da_garagem
      - light.luz_arandelas_principais
      - light.luz_arandelas_da_varanda
      - light.luz_da_area_da_piscina
      - light.refretores_piscina
      - light.luz_da_entrada
      - light.luz_varanda_fundos
      - light.luz_dos_postes
      - light.luz_da_lavanderia
      - light.luz_do_banheiro_da_suite
      - light.luz_do_banheiro_social
      - light.luz_do_lavabo
      - light.luz_da_cozinha
      - light.luz_da_pia
      - light.luz_do_bebedor
      - light.luz_pendentes
      - light.luz_sala_game
      - light.luz_central
      - light.luz_trilhos
      - light.luz_da_cabeceira
      - light.luz_jf
      - light.luz_da_entrada_garagem
      - light.luz_da_mesa_de_jantar
      - light.luz_do_lustre
      - light.luz_da_sala_de_estar
      - light.luz_do_quarto_da_frente
      - light.luz_do_quarto_do_meio
      - light.luz_do_corredor
      - light.luz_da_suite
      - light.yeelight_color1_7c49eb15924b
      - light.luz_do_closet
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: sensor.donos_em_casa
    state: 'off'
  action:
  - service: notify.telegramtodos
    data_template:
      message: >
        Luz: {{ trigger.to_state.attributes.friendly_name }} {{ trigger.to_state.state }}

#  _____  _                     _ _   _                  _   _       _   _  __
# |  __ \(_)                   (_) | (_)                | \ | |     | | (_)/ _|
# | |  | |_ ___ _ __   ___  ___ _| |_ ___   _____  ___  |  \| | ___ | |_ _| |_
# | |  | | / __| '_ \ / _ \/ __| | __| \ \ / / _ \/ __| | . ` |/ _ \| __| |  _|
# | |__| | \__ \ |_) | (_) \__ \ | |_| |\ V / (_) \__ \ | |\  | (_) | |_| | |_
# |_____/|_|___/ .__/ \___/|___/_|\__|_| \_/ \___/|___/ |_| \_|\___/ \__|_|_(_)
#              |_|
#
# Notifica se quando um dispositivo switch ligar/desligar se ninguem estiver em casa
- alias: 'Notificação: Switch On/Off'
  initial_state: true
  trigger:
  - entity_id:
      - switch.ventilador
      - switch.tv_do_quarto
      - switch.ar_quarto
      - switch.xboom_som
      - switch.tv_lg_55
      - switch.htv
      - switch.pressurizador
    from: 'off'
    platform: state
    to: 'on'
  - entity_id:
      - switch.ventilador
      - switch.tv_do_quarto
      - switch.ar_quarto
      - switch.xboom_som
      - switch.tv_lg_55
      - switch.htv
      - switch.pressurizador
    from: 'on'
    platform: state
    to: 'off'
  condition:
  - condition: state
    entity_id: sensor.donos_em_casa
    state: 'off'
  action:
  - service: notify.telegramtodos
    data_template:
      message: >
        {{ trigger.to_state.attributes.friendly_name }} {{ trigger.to_state.state }}

#  _   _       _   _  __  __      __
# | \ | |     | | (_)/ _| \ \    / /
# |  \| | ___ | |_ _| |_   \ \  / /__ ____
# | . ` |/ _ \| __| |  _|   \ \/ / _ \_  /
# | |\  | (_) | |_| | |_     \  / (_) / /
# |_| \_|\___/ \__|_|_(_)     \/ \___/___|
#
# Fala temperatura externa ao ligar o climatizador
- alias: "Falar Temperatura ao ligar Ar"
  initial_state: false
  trigger:
  - platform: state
    entity_id: climate.climatizador
    from: 'off'
    to: 'auto'
  action:
  - service_template: >
        {% if is_state("input_select.padrao_tts", "Google") %} tts.google_translate_say
        {% elif is_state("input_select.padrao_tts", "Voicerss") %} tts.voicerss_say
        {% elif is_state("input_select.padrao_tts", "Watson") %} tts.watson_tts_say
        {% elif is_state("input_select.padrao_tts", "Amazon") %} tts.amazon_polly_say
        {% endif %}
    data_template:
      entity_id: media_player.google_home
      message: 'Temperatura externa é de {{ states.sensor.dark_sky_temperature.state | int }} graus.'

# Da boas vindas ao abrir porta da frente, e envia foto (Apenas uma ideia...)
- alias: "Porta entrada aberta"
  initial_state: false
  trigger:
  - platform: state
    entity_id: binary_sensor.porta_entrada
    from: 'off'
    to: 'on'
  action:
  - service_template: >
        {% if is_state("input_select.padrao_tts", "Google") %} tts.google_translate_say
        {% elif is_state("input_select.padrao_tts", "Voicerss") %} tts.voicerss_say
        {% elif is_state("input_select.padrao_tts", "Watson") %} tts.watson_tts_say
        {% elif is_state("input_select.padrao_tts", "Amazon") %} tts.amazon_polly_say
        {% endif %}
    data_template:
      entity_id: media_player.google_home
      message: Seja bem vindo.
  - delay:
      milliseconds: 600
  - service: script.turn_on
    entity_id: script.fotos_interna

#  _____                            _            _ 
# |  __ \                          | |          | |
# | |  | | ___  ___ _ __   ___ _ __| |_ __ _  __| | ___  _ __ 
# | |  | |/ _ \/ __| '_ \ / _ \ '__| __/ _` |/ _` |/ _ \| '__|
# | |__| |  __/\__ \ |_) |  __/ |  | || (_| | (_| | (_) | |
# |_____/ \___||___/ .__/ \___|_|   \__\__,_|\__,_|\___/|_|
#                  |_|
# Despertador (A)
- alias: "Conf. Despertador 1"
  initial_state: true
  trigger:
    platform: template
    value_template: '{{ states.sensor.time.state == states.sensor.despert1_despertar_automacao.state }}'
  condition:
    condition: state
    entity_id: input_boolean.despert1_status
    state: 'on'
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: >
        {% if is_state("input_select.despert1_src", "do Quarto") %} media_player.google_home
        {% elif is_state("input_select.despert1_src", "da Sala") %} media_player.google_home_sala
        {% elif is_state("input_select.despert1_src", "Todos") %} media_player.todos_google_homes
        {% endif %}
      volume_level: '{{  states.input_number.despert1_volume.state  }}'
  - service_template: >
        {% if is_state("input_select.despert1_tts", "Google") %} tts.google_translate_say
        {% elif is_state("input_select.despert1_tts", "Voicerss") %} tts.voicerss_say
        {% elif is_state("input_select.despert1_tts", "Watson") %} tts.watson_tts_say
        {% elif is_state("input_select.despert1_tts", "Amazon") %} tts.amazon_polly_say
        {% endif %}
    data_template:
      entity_id: >
        {% if is_state("input_select.despert1_src", "do Quarto") %} media_player.google_home
        {% elif is_state("input_select.despert1_src", "da Sala") %} media_player.google_home_sala
        {% elif is_state("input_select.despert1_src", "Todos") %} media_player.todos_google_homes
        {% endif %}
      message: >
        {{ states.input_text.despert1_mensagem.state }}. São {{ states.input_number.despert1_hora.state | int }} horas
        {% if states('input_number.despert1_minuto')|float > 0 %}
          e {{ states.input_number.despert1_minuto.state | int }} minutos!
        {%- else -%}
          em ponto!
        {% endif %}
        {% if is_state('input_boolean.despert1_tempo', 'on') %}
          Faz {{ states.sensor.dark_sky_temperature.state | int }} graus lá fora.
          E {{ states.sensor.suite_temperatura.state | int }} graus aqui dentro. {{ states.sensor.dark_sky_hourly_summary.state }}. 
          e nos próximos dias: {{ states.sensor.dark_sky_daily_summary.state }}
        {% endif %}
  - delay:
      seconds: 25
  -  service: media_player.play_media
     data_template:
       entity_id: >
        {% if is_state("input_select.despert1_src", "do Quarto") %} media_player.google_home
        {% elif is_state("input_select.despert1_src", "da Sala") %} media_player.google_home_sala
        {% elif is_state("input_select.despert1_src", "Todos") %} media_player.todos_google_homes
        {% endif %}
       media_content_id: >
        {% if is_state("input_select.despert1_audio_str", "Classic Rock Florida") %} http://us4.internet-radio.com:8258/stream
        {% elif is_state("input_select.despert1_audio_str", "Mix FM") %} http://mixaac.crossradio.com.br:10000/stream
        {% elif is_state("input_select.despert1_audio_str", "Kiss FM Brasil") %} http://199.233.234.34:8022/live
        {% elif is_state("input_select.despert1_audio_str", "Blues") %} http://i4.streams.ovh:8352/stream
        {% elif is_state("input_select.despert1_audio_str", "Diney") %} http://edge-np.cdn.mdstrm.com/5a9ee30411c043ae48e40bce.mp3
        {% elif is_state("input_select.despert1_audio_str", "Coca-Cola") %} https://ic.imusicaradios.com.br/brasil.stream.http?url=br_-_coca-cola_-_fm&1557842165443
        {% elif is_state("input_select.despert1_audio_str", "Transamerica") %} http://transamerica.crossradio.com.br:9100/stream
        {% elif is_state("input_select.despert1_audio_str", "BBC") %} http://bbcmedia.ic.llnwd.net/stream/bbcmedia_radio1_mf_p
        {% elif is_state("input_select.despert1_audio_str", "DubBase FM") %} http://stream.dubbase.fm:7002
        {% endif %}
       media_content_type: 'music'

# Despertador (B)
- alias: "Conf. Despertador 2"
  initial_state: true
  trigger:
    platform: template
    value_template: '{{ states.sensor.time.state == states.sensor.despert2_despertar_automacao.state }}'
  condition:
    condition: state
    entity_id: input_boolean.despert2_status
    state: 'on'
  action:
  - service: media_player.volume_set
    data_template:
      entity_id: >
        {% if is_state("input_select.despert2_src", "do Quarto") %} media_player.google_home
        {% elif is_state("input_select.despert2_src", "da Sala") %} media_player.google_home_sala
        {% elif is_state("input_select.despert2_src", "Todos") %} media_player.todos_google_homes
        {% endif %}
      volume_level: '{{  states.input_number.despert2_volume.state  }}'
  - service_template: >
        {% if is_state("input_select.despert2_tts", "Google") %} tts.google_translate_say
        {% elif is_state("input_select.despert2_tts", "Voicerss") %} tts.voicerss_say
        {% elif is_state("input_select.despert2_tts", "Watson") %} tts.watson_tts_say
        {% elif is_state("input_select.despert2_tts", "Amazon") %} tts.amazon_polly_say
        {% endif %}
    data_template:
      entity_id: >
        {% if is_state("input_select.despert2_src", "do Quarto") %} media_player.google_home
        {% elif is_state("input_select.despert2_src", "da Sala") %} media_player.google_home_sala
        {% elif is_state("input_select.despert2_src", "Todos") %} media_player.todos_google_homes
        {% endif %}
      message: >
        {{ states.input_text.despert2_mensagem.state }}. São {{ states.input_number.despert2_hora.state | int }} horas
        {% if states('input_number.despert2_minuto')|float > 0 %}
          e {{ states.input_number.despert2_minuto.state | int }} minutos!
        {%- else -%}
          em ponto!
        {% endif %}
        {% if is_state('input_boolean.despert2_tempo', 'on') %}
          Faz {{ states.sensor.dark_sky_temperature.state | int }} graus lá fora.
          E {{ states.sensor.suite_temperatura.state | int }} graus aqui dentro. {{ states.sensor.dark_sky_hourly_summary.state }}. 
          e nos próximos dias: {{ states.sensor.dark_sky_daily_summary.state }}
        {% endif %}
  - delay:
      seconds: 25
  -  service: media_player.play_media
     data_template:
       entity_id: >
        {% if is_state("input_select.despert2_src", "do Quarto") %} media_player.google_home
        {% elif is_state("input_select.despert2_src", "da Sala") %} media_player.google_home_sala
        {% elif is_state("input_select.despert2_src", "Todos") %} media_player.todos_google_homes
        {% endif %}
       media_content_id: >
        {% if is_state("input_select.despert2_audio_str", "Classic Rock Florida") %} http://us4.internet-radio.com:8258/stream
        {% elif is_state("input_select.despert2_audio_str", "Mix FM") %} http://mixaac.crossradio.com.br:10000/stream
        {% elif is_state("input_select.despert2_audio_str", "Kiss FM Brasil") %} http://199.233.234.34:8022/live
        {% elif is_state("input_select.despert2_audio_str", "Blues") %} http://i4.streams.ovh:8352/stream
        {% elif is_state("input_select.despert2_audio_str", "Diney") %} http://edge-np.cdn.mdstrm.com/5a9ee30411c043ae48e40bce.mp3
        {% elif is_state("input_select.despert2_audio_str", "Coca-Cola") %} https://ic.imusicaradios.com.br/brasil.stream.http?url=br_-_coca-cola_-_fm&1557842165443
        {% elif is_state("input_select.despert2_audio_str", "Transamerica") %} http://transamerica.crossradio.com.br:9100/stream
        {% elif is_state("input_select.despert2_audio_str", "BBC") %} http://bbcmedia.ic.llnwd.net/stream/bbcmedia_radio1_mf_p
        {% elif is_state("input_select.despert2_audio_str", "DubBase FM") %} http://stream.dubbase.fm:7002
        {% endif %}
       media_content_type: 'music'

#  _______        _      _____                                      _  _  ____ ____  __  __ _
# |__   __|      | |    / ____|                                    | || ||___ \___ \|  \/  | |
#    | | ___  ___| |_  | (___   ___ _ __  ___  ___  _ __ ___  ___  | || |_ __) |__) | \  / | |__  ____
#    | |/ _ \/ __| __|  \___ \ / _ \ '_ \/ __|/ _ \| '__/ _ \/ __| |__   _|__ <|__ <| |\/| | '_ \|_  /
#    | |  __/\__ \ |_   ____) |  __/ | | \__ \ (_) | | |  __/\__ \    | | ___) |__) | |  | | | | |/ /
#    |_|\___||___/\__| |_____/ \___|_| |_|___/\___/|_|  \___||___/    |_||____/____/|_|  |_|_| |_/___|
#
# Envia notificação para telegram de Rudi quando sensor é "violado"
- alias: "Alarme - Testar Sensores"
  initial_state: false
  trigger:
  - platform: state
    entity_id:
      - binary_sensor.sala_social
      - binary_sensor.sala_jantar
      - binary_sensor.corredor
      - binary_sensor.closet
      - binary_sensor.ext_garagem
      - binary_sensor.ext_piscina
      - binary_sensor.porta_varanda
      - binary_sensor.porta_entrada
      - binary_sensor.porta_garagem
      - binary_sensor.porta_lavanderia
      - binary_sensor.porta_area
      - binary_sensor.janela_closet
      - binary_sensor.janela_cozinha
      - binary_sensor.janela_suite
      - binary_sensor.janela_quarto_f
      - binary_sensor.janela_quarto_m
    to: 'on'
  action:
  - service: notify.telegramrudi
    data_template:
      message: >
        [OK] : {{ trigger.to_state.attributes.friendly_name }}
  - service: notify.pushhtml5
    data_template:
      message: >
        [OK] : {{ trigger.to_state.attributes.friendly_name }}

#                _          _____            _ _                    _________      __
#     /\        | |        |  __ \          | (_)                  |__   __\ \    / /
#    /  \  _   _| |_ ___   | |  | | ___  ___| |_  __ _  __ _ _ __     | |   \ \  / /
#   / /\ \| | | | __/ _ \  | |  | |/ _ \/ __| | |/ _` |/ _` | '__|    | |    \ \/ /
#  / ____ \ |_| | || (_) | | |__| |  __/\__ \ | | (_| | (_| | |       | |     \  /
# /_/    \_\__,_|\__\___/  |_____/ \___||___/_|_|\__, |\__,_|_|       |_|      \/
#                                                 __/ |
#                                                |___/
# TV do quarto desliga se o chromecast nao estiver reproduzindo nada por 5 min
# Isso pq na tv do quarto só tenho um chromecast.
- alias: Tv Quarto Desliga - (Sem Player 5min)
  initial_state: true
  trigger:
    platform: state
    entity_id: media_player.tv_do_quarto
    to: 'off'
    for:
      minutes: 5
  action:
  - service: switch.turn_off
    entity_id: switch.tv_quarto
  - service: notify.telegramtodos
    data:
      message: 'Desliguei a TV do quarto! Parece que ninguém estava assistindo.'


#  __  __            _                      _                    _                              ____  ______ ______
# |  \/  |          (_)                    | |                  | |                            / __ \|  ____|  ____|
# | \  / | _____   ___ _ __ ___   ___ _ __ | |_ ___  ___    __ _| | __ _ _ __ _ __ ___   ___  | |  | | |__  | |__
# | |\/| |/ _ \ \ / / | '_ ` _ \ / _ \ '_ \| __/ _ \/ __|  / _` | |/ _` | '__| '_ ` _ \ / _ \ | |  | |  __| |  __|
# | |  | | (_) \ V /| | | | | | |  __/ | | | || (_) \__ \ | (_| | | (_| | |  | | | | | |  __/ | |__| | |    | |
# |_|  |_|\___/ \_/ |_|_| |_| |_|\___|_| |_|\__\___/|___/  \__,_|_|\__,_|_|  |_| |_| |_|\___|  \____/|_|    |_|
#  ______      _                                                     _               __
# |  ____|    | |                                                   (_)             /_/
# | |__  __  _| |_ ___ _ __ _ __   ___    ___  ___ _ __ ___    _ __  _ _ __   __ _  ___ _ __ ___     ___ _ __ ___     ___ __ _ ___  __ _
# |  __| \ \/ / __/ _ \ '__| '_ \ / _ \  / __|/ _ \ '_ ` _ \  | '_ \| | '_ \ / _` |/ _ \ '_ ` _ \   / _ \ '_ ` _ \   / __/ _` / __|/ _` |
# | |____ >  <| ||  __/ |  | | | | (_) | \__ \  __/ | | | | | | | | | | | | | (_| |  __/ | | | | | |  __/ | | | | | | (_| (_| \__ \ (_| |
# |______/_/\_\\__\___|_|  |_| |_|\___/  |___/\___|_| |_| |_| |_| |_|_|_| |_|\__, |\___|_| |_| |_|  \___|_| |_| |_|  \___\__,_|___/\__,_|
#                                                                             __/ |
#                                                                            |___/
# Movimento area da piscina
- alias: "Piscina (Alarme OFF) - Movimento"
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.ext_piscina
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: sensor.donos_em_casa
    state: 'off'
  - condition: state
    entity_id: alarm_control_panel.alarme_da_casa
    state: disarmed
    # não envia novamente se acontecer movimento nos proximos 20seg
  - condition: template
    value_template: '{{ as_timestamp(now()) - as_timestamp(states.automation.piscina_alarme_off_movimento.attributes.last_triggered) | int > 20 }}'
  action:
  - service: notify.telegramtodos
    data:
      message: "Movimento na área da piscina"
  - service: script.turn_on
    entity_id: script.fotos_piscina
  - service: script.turn_on
    entity_id: script.fotos_380rtsp1


# Movimento na garagem
- alias: "Garagem (Alarme OFF) - Movimento"
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.ext_garagem
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: sensor.donos_em_casa
    state: 'off'
  - condition: state
    entity_id: alarm_control_panel.alarme_da_casa
    state: disarmed
    # não envia novamente se acontecer movimento nos proximos 20seg
  - condition: template
    value_template: '{{ as_timestamp(now()) - as_timestamp(states.automation.garagem_alarme_off_movimento.attributes.last_triggered) | int > 20 }}'
  action:
  - service: notify.telegramtodos
    data:
      message: "Movimento na Garagem"
  - service: script.turn_on
    entity_id: script.fotos_garagem_dupla

# Notifica se algum sensor for violado mesmo com alarme off, porém sem ninguem em casa.
- alias: 'Notificação: Sensor Alarme Off (S/Ninguém)'
  initial_state: true
  trigger:
  - entity_id:
      - binary_sensor.sala_social
      - binary_sensor.sala_jantar
      - binary_sensor.corredor
      - binary_sensor.closet
      - binary_sensor.porta_varanda
      - binary_sensor.porta_entrada
      - binary_sensor.porta_garagem
      - binary_sensor.porta_lavanderia
      - binary_sensor.porta_area
      - binary_sensor.janela_closet
      - binary_sensor.janela_cozinha
      - binary_sensor.janela_suite
      - binary_sensor.janela_quarto_f
      - binary_sensor.janela_quarto_m
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: sensor.donos_em_casa
    state: 'off'
  - condition: state
    entity_id: alarm_control_panel.alarme_da_casa
    state: disarmed
  action:
  - service: notify.telegramtodos
    data_template:
      message: >
        <b>Sensor violado</b>: {{ trigger.to_state.attributes.friendly_name }}

#  __  __            _                      _                   _                              ____  _   _
# |  \/  |          (_)                    | |            /\   | |                            / __ \| \ | |
# | \  / | _____   ___ _ __ ___   ___ _ __ | |_ ___      /  \  | | __ _ _ __ _ __ ___   ___  | |  | |  \| |
# | |\/| |/ _ \ \ / / | '_ ` _ \ / _ \ '_ \| __/ _ \    / /\ \ | |/ _` | '__| '_ ` _ \ / _ \ | |  | | . ` |
# | |  | | (_) \ V /| | | | | | |  __/ | | | || (_) |  / ____ \| | (_| | |  | | | | | |  __/ | |__| | |\  |
# |_|  |_|\___/ \_/ |_|_| |_| |_|\___|_| |_|\__\___/  /_/    \_\_|\__,_|_|  |_| |_| |_|\___|  \____/|_| \_|
#

# Movimento suspeitos area piscina
- alias: "Piscina (Alarme ON) - Movimento"
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.ext_piscina
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: alarm_control_panel.alarme_da_casa
    state: armed_away
  action:
  - service: notify.telegramtodos
    data:
      message: "Movimento na área da piscina"
  - delay:
      milliseconds: 700
  - service: script.turn_on
    entity_id: script.fotos_piscina
  - service: script.turn_on
    entity_id: script.fotos_380rtsp1

# Liga luz area piscina e postes se movimento com alarme ativado
- alias: "Piscina (Alarme ON) - Luz (Movimento)"
  initial_state: true
  trigger:
  - entity_id: binary_sensor.ext_piscina
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - condition: state
    entity_id: alarm_control_panel.alarme_da_casa
    state: armed_away
  - condition: state
    entity_id: sun.sun
    state: below_horizon
  action:
  - service: light.turn_on
    data:
      entity_id:
        - light.luz_dos_postes
        - light.varanda_fundo
        - light.luz_da_area_da_piscina
        - light.luz_da_garagem
        - light.luz_arandelas_principais

# Desliga luz area piscina e postes se nao tiver mais movimento
- alias: "Piscina (Alarme ON) - Luz (S/Movimento)"
  initial_state: true
  trigger:
    platform: state
    entity_id: binary_sensor.ext_piscina
    to: 'off'
    for:
      minutes: 2
  condition:
  - condition: state
    entity_id: alarm_control_panel.alarme_da_casa
    state: armed_away
  action:
    service: light.turn_off
    data:
      entity_id:
        - light.luz_dos_postes
        - light.varanda_fundo
        - light.luz_da_area_da_piscina
        - light.luz_da_garagem
        - light.luz_arandelas_principais

# Movimento suspeitos garagem
- alias: "Garagem (Alarme ON) - Movimento"
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.ext_garagem
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: alarm_control_panel.alarme_da_casa
    state: armed_away
  action:
  - service: notify.telegramtodos
    data:
      message: "Movimento na garagem"
  - service: script.turn_on
    entity_id: script.fotos_garagem_dupla


# Liga luz garagem e postes se movimento com alarme ativado
- alias: "Garagem (Alarme ON) - Luz (Movimento)"
  initial_state: true
  trigger:
  - entity_id: binary_sensor.ext_garagem
    from: 'off'
    platform: state
    to: 'on'

  condition:
  - condition: state
    entity_id: alarm_control_panel.alarme_da_casa
    state: armed_away
  - condition: state
    entity_id: sun.sun
    state: below_horizon
  action:
  - service: light.turn_on
    data:
      entity_id:
        - light.luz_dos_postes
        - light.luz_da_garagem
        - light.varanda_fundo
        - light.luz_da_area_da_piscina
        - light.luz_arandelas_principais

# Desliga luz garagem e postes se nao tiver mais movimento
- alias: "Garagem (Alarme ON) - Luz (S/Movimento)"
  initial_state: true
  trigger:
    platform: state
    entity_id: binary_sensor.ext_garagem
    to: 'off'
    for:
      minutes: 2
  condition:
  - condition: state
    entity_id: alarm_control_panel.alarme_da_casa
    state: armed_away
  action:
    service: light.turn_off
    data:
      entity_id:
        - light.luz_dos_postes
        - light.luz_da_garagem
        - light.varanda_fundo
        - light.luz_da_area_da_piscina
        - light.luz_arandelas_principais

#           _
#     /\   | |
#    /  \  | | __ _ _ __ _ __ ___   ___
#   / /\ \ | |/ _` | '__| '_ ` _ \ / _ \
#  / ____ \| | (_| | |  | | | | | |  __/
# /_/    \_\_|\__,_|_|  |_| |_| |_|\___|


- alias: "Alarme - Aviso que será ativado"
  initial_state: true
  trigger:
  - platform: state
    entity_id: alarm_control_panel.alarme_da_casa
    to: arming
#    pending
  action:
  - service: script.turn_on
    entity_id: script.reseta_sensores
  - service: switch.turn_on
    data:
      entity_id: switch.sirenes
  - service: switch.turn_off
    data:
      entity_id: switch.sirenes
  - service: notify.telegramtodos
    data:
      message: Alarme será ativo em 10s.
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.google_home_sala
      volume_level: 0.9
  - service_template: >
        {% if is_state("input_select.padrao_tts", "Google") %} tts.google_translate_say
        {% elif is_state("input_select.padrao_tts", "Voicerss") %} tts.voicerss_say
        {% elif is_state("input_select.padrao_tts", "Watson") %} tts.watson_tts_say
        {% elif is_state("input_select.padrao_tts", "Amazon") %} tts.amazon_polly_say
        {% endif %}
    data_template:
      entity_id: media_player.google_home_sala
      message: Ativando alarme em 10 segundos.

- alias: "Alarme - Notif. que foi ativado"
  initial_state: true
  trigger:
  - platform: state
    entity_id: alarm_control_panel.alarme_da_casa
    to: armed_away
  action:
  - service: notify.telegramtodos
    data:
      message: Alarme ativado!
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.google_home_sala
      volume_level: 0.9
  - service_template: >
        {% if is_state("input_select.padrao_tts", "Google") %} tts.google_translate_say
        {% elif is_state("input_select.padrao_tts", "Voicerss") %} tts.voicerss_say
        {% elif is_state("input_select.padrao_tts", "Watson") %} tts.watson_tts_say
        {% elif is_state("input_select.padrao_tts", "Amazon") %} tts.amazon_polly_say
        {% endif %}
    data_template:
      entity_id: media_player.google_home_sala
      message: "Alarme ativado!"

# Quando ativo apaga todas as luzes
- alias: "Alarme - Apaga todas as luzes quando ativo"
  initial_state: true
  trigger:
  - platform: state
    entity_id: alarm_control_panel.alarme_da_casa
    to: armed_away
  action:
  - service: light.turn_off
    data:
      entity_id: group.all_lights

# Desliga sirene ao ser desativado
- alias: "Alarme - Desliga sirene ao ser desativado"
  initial_state: true
  trigger:
  - platform: state
    entity_id: alarm_control_panel.alarme_da_casa
    to: disarmed
  action:
  - service: switch.turn_off
    data:
      entity_id: switch.sirenes

# Notifica quando disparar
- alias: "Alarme - Aviso desativado"
  initial_state: true
  trigger:
  - platform: state
    entity_id: alarm_control_panel.alarme_da_casa
    to: disarmed
  action:
  - service: switch.turn_on
    data:
      entity_id: switch.sirenes
  - service: switch.turn_off
    data:
      entity_id: switch.Sirenes
  - service: notify.telegramtodos
    data:
      message: Alarme desativado!
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.google_home_sala
      volume_level: 0.9
  - service_template: >
        {% if is_state("input_select.padrao_tts", "Google") %} tts.google_translate_say
        {% elif is_state("input_select.padrao_tts", "Voicerss") %} tts.voicerss_say
        {% elif is_state("input_select.padrao_tts", "Watson") %} tts.watson_tts_say
        {% elif is_state("input_select.padrao_tts", "Amazon") %} tts.amazon_polly_say
        {% endif %}
    data_template:
      entity_id: media_player.google_home_sala
      message: Alarme desativado!

# Dispara ao ter sensor violado, notifica envia imagens/videos!!!
- alias: "Alarme - Disparar ao ter sensor violado"
  initial_state: true
  trigger:
  - platform: state
    entity_id:
      - binary_sensor.sala_social
      - binary_sensor.sala_jantar
      - binary_sensor.corredor
      - binary_sensor.closet
      - binary_sensor.porta_varanda
      - binary_sensor.porta_entrada
      - binary_sensor.porta_garagem
      - binary_sensor.porta_lavanderia
      - binary_sensor.porta_area
      - binary_sensor.janela_closet
      - binary_sensor.janela_cozinha
      - binary_sensor.janela_suite
      - binary_sensor.janela_quarto_f
      - binary_sensor.janela_quarto_m
#      - binary_sensor.ext_garagem
#      - binary_sensor.ext_piscina
    to: 'on'
  condition:
  - condition: state
    entity_id: alarm_control_panel.alarme_da_casa
    state: armed_away
  action:
  # Liga sirenes
  - service: switch.turn_on
    data:
      entity_id: switch.sirenes
  # Liga todas as luzes
  - service: light.turn_on
    data:
      entity_id:
        - group.all_lights
  - service: notify.telegramtodos
    data:
      message: '!!! O ALARME DISPAROU !!!'
  # Envia mensagem com ql sensor foi violado
  - service: notify.telegramtodos
    data_template:
      message: >
        Sensor: {{ trigger.to_state.attributes.friendly_name }}
  # Mensagem de audio nos google homes
  - service: media_player.volume_set
    data_template:
      entity_id: media_player.todos_google_homes
      volume_level: 0.9
  - service_template: >
        {% if is_state("input_select.padrao_tts", "Google") %} tts.google_translate_say
        {% elif is_state("input_select.padrao_tts", "Voicerss") %} tts.voicerss_say
        {% elif is_state("input_select.padrao_tts", "Watson") %} tts.watson_tts_say
        {% elif is_state("input_select.padrao_tts", "Amazon") %} tts.amazon_polly_say
        {% endif %}
    data_template:
      entity_id: media_player.google_home
      message: Sensor {{ trigger.to_state.attributes.friendly_name }} violado. Pau vai comê!
  # Envia foto/video comara interna
  - service: script.turn_on
    entity_id: script.fotos_piscina
  - service: script.turn_on
    entity_id: script.fotos_interna
  - service: script.turn_on
    entity_id: script.fotos_garagem_dupla
  - service: script.turn_on
    entity_id: script.fotos_380rtsp1
  - service: script.turn_on
    entity_id: script.telegram_call_alarme

# Ligação Parou de funcionar
#  - service: notify.twilio
#    data:
#      message: 'Alarme disparou! Alarme disparou! Alarme disparou! Alarme disparou! Alarme disparou! Alarme disparou!'
#      target:
#        - +5555999382319

#                _          _____            _ _                    _
#     /\        | |        |  __ \          | (_)                  | |
#    /  \  _   _| |_ ___   | |  | | ___  ___| |_  __ _  __ _ _ __  | |    _   _ _______  ___
#   / /\ \| | | | __/ _ \  | |  | |/ _ \/ __| | |/ _` |/ _` | '__| | |   | | | |_  / _ \/ __|
#  / ____ \ |_| | || (_) | | |__| |  __/\__ \ | | (_| | (_| | |    | |___| |_| |/ /  __/\__ \
# /_/    \_\__,_|\__\___/  |_____/ \___||___/_|_|\__, |\__,_|_|    |______\__,_/___\___||___/
#                                                 __/ |
#                                                |___/
# Desliga luzes dos banheiros se ficar muito tempo ligada e notifica no google home

# Banheiro da suite
- alias: Luz Sem desligar - Banheiro Suite
  trigger:
    platform: state
    entity_id: light.luz_do_banheiro_da_suite
    to: 'on'
  action:
    service: timer.start
    entity_id: timer.timer_suite
    data_template:
      duration: '00:{{ states.input_number.tempo_banheiro_suite.state | int }}:00'

- alias: "Cancela Timer Suite"
  trigger:
    platform: state
    entity_id: light.luz_do_banheiro_da_suite
    to: 'off'
  action:
    service: timer.cancel
    entity_id: timer.timer_suite

- alias: Timer Suite
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_suite
  action:
  - service: light.turn_off
    entity_id: light.luz_do_banheiro_da_suite
  - service_template: >
        {% if is_state("input_select.padrao_tts", "Google") %} tts.google_translate_say
        {% elif is_state("input_select.padrao_tts", "Voicerss") %} tts.voicerss_say
        {% elif is_state("input_select.padrao_tts", "Watson") %} tts.watson_tts_say
        {% elif is_state("input_select.padrao_tts", "Amazon") %} tts.amazon_polly_say
        {% endif %}
    data_template:
      entity_id: media_player.todos_google_homes
      message: "Oops! Desliguei a luz do banheiro da suíte, estava à {{ states.input_number.tempo_banheiro_suite.state | int }} minutos ligada!"

# Banheiro social
- alias: Luz Sem desligar - Banheiro Social
  trigger:
    platform: state
    entity_id: light.luz_do_banheiro_social
    to: 'on'
  action:
    service: timer.start
    entity_id: timer.timer_social
    data_template:
      duration: '00:{{ states.input_number.tempo_banheiro_social.state | int }}:00'

- alias: "Cancela Timer Social"
  trigger:
    platform: state
    entity_id: light.luz_do_banheiro_social
    to: 'off'
  action:
    service: timer.cancel
    entity_id: timer.timer_social

- alias: Timer Social
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_social
  action:
  - service: light.turn_off
    entity_id: light.luz_do_banheiro_social
  - service_template: >
        {% if is_state("input_select.padrao_tts", "Google") %} tts.google_translate_say
        {% elif is_state("input_select.padrao_tts", "Voicerss") %} tts.voicerss_say
        {% elif is_state("input_select.padrao_tts", "Watson") %} tts.watson_tts_say
        {% elif is_state("input_select.padrao_tts", "Amazon") %} tts.amazon_polly_say
        {% endif %}
    data_template:
      entity_id: media_player.todos_google_homes
      message: "Oops! Desliguei a luz do banheiro social, estava à {{ states.input_number.tempo_banheiro_social.state | int }} minutos ligada!"


# Banheiro lavabo
- alias: "Luz Sem desligar - Lavabo"
  trigger:
    platform: state
    entity_id: light.luz_do_lavabo
    to: 'on'
  action:
    service: timer.start
    entity_id: timer.timer_lavabo
    data_template:
      duration: '00:{{ states.input_number.tempo_banheiro_lavabo.state | int }}:00'

- alias: "Cancela Timer Lavabo"
  trigger:
    platform: state
    entity_id: light.luz_do_lavabo
    to: 'off'
  action:
    service: timer.cancel
    entity_id: timer.timer_lavabo

- alias: Timer Lavabo
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_lavabo
  action:
  - service: light.turn_off
    entity_id: light.luz_do_lavabo
  - service_template: >
        {% if is_state("input_select.padrao_tts", "Google") %} tts.google_translate_say
        {% elif is_state("input_select.padrao_tts", "Voicerss") %} tts.voicerss_say
        {% elif is_state("input_select.padrao_tts", "Watson") %} tts.watson_tts_say
        {% elif is_state("input_select.padrao_tts", "Amazon") %} tts.amazon_polly_say
        {% endif %}
    data_template:
      entity_id: media_player.todos_google_homes
      message: "Oops! Desliguei a luz do lavabo, estava à {{ states.input_number.tempo_banheiro_lavabo.state | int }} minutos ligada!"

#  _                  _____                        _
# | |                / ____|                      | |
# | |    _   _ ____ | |     ___  _ __ _ __ ___  __| | ___  _ __
# | |   | | | |_  / | |    / _ \| '__| '__/ _ \/ _` |/ _ \| '__|
# | |___| |_| |/ /  | |___| (_) | |  | | |  __/ (_| | (_) | |
# |______\__,_/___|  \_____\___/|_|  |_|  \___|\__,_|\___/|_|

# Liga se tiver movimento quando o sol se poe
- alias: Luz Corredor Liga (Movimento)
  initial_state: true
  trigger:
    platform: state
    entity_id: binary_sensor.corredor
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: sun.sun
    state: 'below_horizon'
  action:
    service: light.turn_on
    entity_id: light.luz_do_corredor

# Nublado de dia
- alias: Luz Corredor Liga Nublado (Movimento)
  initial_state: true
  trigger:
    platform: state
    entity_id: binary_sensor.corredor
    from: 'off'
    to: 'on'
  condition:
    - condition: numeric_state
      entity_id: sensor.dark_sky_cloud_coverage
      above: 75
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
  action:
    service: light.turn_on
    entity_id: light.luz_do_corredor

# Poderia iniciar o start na automacao de cima mas se ligado a luz manual nao iniciará o timer
- alias: Luz Corredor Timer
  trigger:
    platform: state
    entity_id: light.luz_do_corredor
    to: 'on'
  action:
    service: timer.start
    entity_id: timer.timer_corredor
    data_template:
      duration: '00:{{ states.input_number.tempo_corredor.state | int }}:00'

- alias: "Cancela Timer Corredor"
  trigger:
    platform: state
    entity_id: light.luz_do_corredor
    to: 'off'
  action:
    service: timer.cancel
    entity_id: timer.timer_corredor

- alias: "Reinicia Timer Corredor com movimento"
  trigger:
    platform: state
    entity_id: binary_sensor.corredor
    from: 'off'
    to: 'on'
  action:
    service: timer.start
    entity_id: timer.timer_corredor

- alias: Luz Corredor Desliga - (S/Movimento)
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_corredor
  action:
    service: light.turn_off
    entity_id: light.luz_do_corredor

#  _                  _____ _                _
# | |                / ____| |              | |
# | |    _   _ ____ | |    | | ___  ___  ___| |_
# | |   | | | |_  / | |    | |/ _ \/ __|/ _ \ __|
# | |___| |_| |/ /  | |____| | (_) \__ \  __/ |_
# |______\__,_/___|  \_____|_|\___/|___/\___|\__|
#
# Liga se tiver movimento
- alias: Luz Closet Liga - (Movimento)
  initial_state: true
  trigger:
    platform: state
    entity_id: binary_sensor.closet
    from: 'off'
    to: 'on'
#  condition:
#    condition: time
#    after: '19:00:00'
#    before: '06:30:00'
  condition:
    condition: state
    entity_id: sun.sun
    state: 'below_horizon'
  action:
    service: light.turn_on
    entity_id: light.luz_do_closet

- alias: Luz Closet Timer
  trigger:
    platform: state
    entity_id: light.luz_do_closet
    to: 'on'
  action:
    service: timer.start
    entity_id: timer.timer_closet
    data_template:
      duration: '00:{{ states.input_number.tempo_closet.state | int }}:00'

- alias: "Cancela Timer Closet"
  trigger:
    platform: state
    entity_id: light.luz_do_closet
    to: 'off'
  action:
    service: timer.cancel
    entity_id: timer.timer_closet

- alias: "Reinicia Timer Closet com movimento"
  trigger:
    platform: state
    entity_id: binary_sensor.closet
    from: 'off'
    to: 'on'
  action:
    service: timer.start
    entity_id: timer.timer_closet

- alias: Luz Closet Desliga - (S/Movimento)
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.timer_closet
  action:
    service: light.turn_off
    entity_id: light.luz_do_closet

#  _                 _____          _                                                  _      _
# | |               |  __ \        | |                       /\                       | |    | |
# | |    _   _ ____ | |__) |__  ___| |_ ___  ___    ___     /  \   _ __ __ _ _ __   __| | ___| | __ _ ___
# | |   | | | |_  / |  ___/ _ \/ __| __/ _ \/ __|  / _ \   / /\ \ | '__/ _` | '_ \ / _` |/ _ \ |/ _` / __|
# | |___| |_| |/ /  | |  | (_) \__ \ ||  __/\__ \ |  __/  / ____ \| | | (_| | | | | (_| |  __/ | (_| \__ \
# |______\__,_/___| |_|   \___/|___/\__\___||___/  \___| /_/    \_\_|  \__,_|_| |_|\__,_|\___|_|\__,_|___/
#
# Liga postes
- alias: "Luz Postes - Ligar"
  initial_state: true
  trigger:
    platform: template
    value_template: '{{ states.sensor.time.state == states.sensor.anoiteceu.state }}'
  condition:
  action:
  - service: light.turn_on
    data:
      entity_id:
        - light.luz_dos_postes
# Desliga postes
- alias: "Luz Postes - Desligar"
  initial_state: true
  trigger:
    platform: template
    value_template: "{{ states('sensor.time') == (states.input_datetime.poste_off.attributes.timestamp | int | timestamp_custom('%H:%M', False)) }}"
  action:
  - service: light.turn_off
    data:
      entity_id:
        - light.luz_dos_postes

# Liga arandelas
- alias: "Luz Arandelas - Ligar"
  initial_state: false
  trigger:
    platform: template
    value_template: '{{ states.sensor.time.state == states.sensor.anoiteceu.state }}'
  condition:
  action:
  - service: light.turn_on
    data:
      entity_id:
        - light.luz_arandelas_principais
        - light.luz_arandelas_da_varanda

# Desliga arandelas
- alias: "Luz Arandelas - Desligar"
  initial_state: true
  trigger:
    platform: template
    value_template: "{{ states('sensor.time') == (states.input_datetime.arandelas_off.attributes.timestamp | int | timestamp_custom('%H:%M', False)) }}"
  action:
  - service: light.turn_off
    data:
      entity_id:
        - light.luz_arandelas_principais
        - light.luz_arandelas_da_varanda


#  _______   _                                   _____                                _
# |__   __| | |                                 / ____|                              | |
#    | | ___| | ___  __ _ _ __ __ _ _ __ ___   | |     ___  _ __ ___   __ _ _ __   __| | ___  ___
#    | |/ _ \ |/ _ \/ _` | '__/ _` | '_ ` _ \  | |    / _ \| '_ ` _ \ / _` | '_ \ / _` |/ _ \/ __|
#    | |  __/ |  __/ (_| | | | (_| | | | | | | | |___| (_) | | | | | | (_| | | | | (_| | (_) \__ \
#    |_|\___|_|\___|\__, |_|  \__,_|_| |_| |_|  \_____\___/|_| |_| |_|\__,_|_| |_|\__,_|\___/|___/
#                    __/ |
#                   |___/
- alias: 'Telegram bot start'
  initial_state: true
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: '/start'
  action:
    - service: notify.telegramtodos
      data:
        message: 'Start bot!'
#    - service: notify.telegramrudi
#      data:
#        message: 'commands'
#        data:
#          keyboard:
#            - '/ping, /fotos'
#            - '/videogaragem, /videopiscina, /videointerno'

- alias: 'Telegram bot responde ping'
  initial_state: true
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: '/ping'
  action:
    - service: notify.telegramrudi
      data:
        message: '<b>pong</b><pre> </pre>Nova Linha<pre>Linha tag pre</pre>Outra linha<pre> </pre><i>Mais linhas</i>'

- alias: 'Telegram bot Fotos cameras'
  initial_state: true
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: '/fotos'
  action:
    - service: notify.telegramtodos
      data:
        message: 'Já mando!!!'
    - service: script.turn_on
      entity_id:
        - script.fotos_garagem_dupla
        - script.fotos_piscina
        - script.fotos_interna
        - script.fotos_380rtsp1
        - script.fotos_380rtsp2


- alias: 'Telegram bot video garagem'
  initial_state: true
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: '/videogaragem'
  action:
    - service: notify.telegramtodos
      data:
        message: 'Já mando!'
    - service: script.turn_on
      entity_id: script.video_garagem

- alias: 'Telegram bot video piscina'
  initial_state: true
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: '/videopiscina'
  action:
    - service: notify.telegramtodos
      data:
        message: 'Tá Bugado, mas vou tentar'
    - service: script.turn_on
      entity_id: script.video_piscina

- alias: 'Telegram bot video interna'
  initial_state: true
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: '/videointerno'
  action:
    - service: notify.telegramtodos
      data:
        message: 'Tá Bugado, mas vou tentar'
    - service: script.turn_on
      entity_id: script.video_interna

- alias: 'Telegram bot foto garagem'
  initial_state: true
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: '/fotogaragem'
  action:
    - service: notify.telegramtodos
      data:
        message: 'Já mando!'
    - service: script.turn_on
      entity_id: script.fotos_garagem_dupla

- alias: 'Telegram bot foto piscina'
  initial_state: true
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: '/fotopiscina'
  action:
    - service: notify.telegramtodos
      data:
        message: 'Já mando!'
    - service: script.turn_on
      entity_id: script.fotos_piscina
    - service: script.turn_on
      entity_id: script.fotos_380rtsp1

- alias: 'Telegram bot foto interna'
  initial_state: true
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: '/fotointerna'
  action:
    - service: notify.telegramtodos
      data:
        message: 'Já mando!'
    - service: script.turn_on
      entity_id: script.fotos_interna

#  _____  _                              
# |  __ \(_)                             
# | |  | |___   _____ _ __ ___  ___  ___ 
# | |  | | \ \ / / _ \ '__/ __|/ _ \/ __|
# | |__| | |\ V /  __/ |  \__ \ (_) \__ \
# |_____/|_| \_/ \___|_|  |___/\___/|___/

# Aviso/Notificação Geladeira aberta por muito tempo
- alias: Geladeira aberta por muito tempo
  initial_state: false
  trigger:
    platform: state
    entity_id: binary_sensor.porta_geladeira
    to: 'on'
    for:
      seconds: 40
  action:
    - service: notify.telegramtodos
      data:
        message: Geladeira aberta por muito tempo!
    - service_template: >
          {% if is_state("input_select.padrao_tts", "Google") %} tts.google_translate_say
          {% elif is_state("input_select.padrao_tts", "Voicerss") %} tts.voicerss_say
          {% elif is_state("input_select.padrao_tts", "Watson") %} tts.watson_tts_say
          {% elif is_state("input_select.padrao_tts", "Amazon") %} tts.amazon_polly_say
          {% endif %}
      data_template:
        entity_id: media_player.google_home_sala
        message: "Ei você aí, Que tal fechar a porta da geladeira!"

- alias: Geladeira aberta auto reset
  initial_state: true
  trigger:
    platform: state
    entity_id: binary_sensor.porta_geladeira
    to: 'on'
    for:
      seconds: 40
  action:
    - service: script.turn_on
      entity_id: script.reseta_porta_geladeira

# Liga luz se abrir varanda na madrugada (Util dog qnd pede para ir fazer xixi)
- alias: Liga luzez na madrugada Varanda Suite
  initial_state: true
  trigger:
    platform: state
    entity_id: binary_sensor.porta_varanda
    from: 'off'
    to: 'on'
  condition:
    condition: time
    after: '23:30:01'
    before: '05:00:00'
  action:
  - service: light.turn_on
    data:
      entity_id:
        - light.luz_dos_postes

# Movimento na garagem a noite sem ninguem em casa ----------------------------- PROVIDENCIAR ATRASO NA CHEGADA $$$$$$
- alias: "Garagem Movimento - Liga Luzez após sol se por"
  initial_state: true
  trigger:
  - platform: state
    entity_id: binary_sensor.ext_garagem
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: sensor.donos_em_casa
    state: 'off'
  - condition: state
    entity_id: sun.sun
    state: below_horizon
# Não repetir nos proximos 10min (tempo de atualizar q ja cheguei em casa)
  - condition: template
    value_template: '{{ as_timestamp(now()) - as_timestamp(states.automation.garagem_movimento_liga_luzez_apos_sol_se_por.attributes.last_triggered) | int > 600 }}'
  action:
  - service: light.turn_on
    data:
      entity_id:
        - light.luz_dos_postes
        - light.luz_da_garagem

# Liga luzes internas ao abrir porta da garagem () ------------------------------>>>>$$$$$$$$$$$$$$$$$$$$
- alias: Liga Luzez int. ao abrir porta garagem (Noite)
  initial_state: true
  trigger:
    platform: state
    entity_id: binary_sensor.porta_garagem
    from: 'off'
    to: 'on'
  condition:
#  - condition: state
#    entity_id: sensor.donos_em_casa
#    state: 'off'
  - condition: state
    entity_id: alarm_control_panel.alarme_da_casa
    state: disarmed
  - condition: state
    entity_id: sun.sun
    state: below_horizon
  - condition: template
    value_template: '{{ as_timestamp(now()) - as_timestamp(states.automation.liga_luzez_int_ao_abrir_porta_garagem_noite.attributes.last_triggered) | int > 21600 }}'
  action:
  - service: light.turn_on
    data:
      entity_id:
        - light.luz_da_mesa_de_jantar
        - light.luz_pendentes
        - light.luz_trilhos
        - light.luz_do_lustre
  - service_template: >
        {% if is_state("input_select.padrao_tts", "Google") %} tts.google_translate_say
        {% elif is_state("input_select.padrao_tts", "Voicerss") %} tts.voicerss_say
        {% elif is_state("input_select.padrao_tts", "Watson") %} tts.watson_tts_say
        {% elif is_state("input_select.padrao_tts", "Amazon") %} tts.amazon_polly_say
        {% endif %}
    data_template:
      entity_id: media_player.google_home_sala
      message: 'Boa noite. Faz {{ states.sensor.cozinha_temperatura.state | int }} graus aqui dentro, e {{ states.sensor.dark_sky_temperature.state | int }} graus lá fora. Tenha uma ótima noite! '


- alias: 'Alerta Maquina de lavar (Desligada)'
  initial_state: true
  trigger:
    - entity_id: sensor.maquina_lavar_status
      from: 'Lavando'
      platform: state
      to: 'Desligada'
  action:
  - service: notify.telegramtodos
    data:
      message: 'À máquina terminou o processo de lavagem! Sua roupra está ponta!'
  - service_template: >
        {% if is_state("input_select.padrao_tts", "Google") %} tts.google_translate_say
        {% elif is_state("input_select.padrao_tts", "Voicerss") %} tts.voicerss_say
        {% elif is_state("input_select.padrao_tts", "Watson") %} tts.watson_tts_say
        {% elif is_state("input_select.padrao_tts", "Amazon") %} tts.amazon_polly_say
        {% endif %}
    data_template:
      entity_id: media_player.todos_google_homes
      message: 'À máquina terminou o processo de lavagem! Sua roupra está pronta!'

- alias: 'Alerta Maquina de lavar (Lavando)'
  initial_state: true
  trigger:
    - platform: state
      entity_id: sensor.maquina_lavar_status
      to: 'Lavando'
      for:
        seconds: 30
  action:
  - service: notify.telegramtodos
    data:
      message: 'Máquina de lavar iniciada'

# Desliga o Pow quando processo de lavagem concluir
- alias: 'Alerta Maquina de lavar (Energia Off)'
  initial_state: true
  trigger:
    - platform: state
      entity_id: sensor.maquina_lavar_status
      to: 'Desligada'
      for:
        seconds: 90
  action:
  - service: switch.turn_off
    data:
      entity_id: switch.maquina_de_lavar

# Ativa modo visitante
- alias: "Modo visitante (ON)"
  initial_state: true
  trigger:
    platform: state
    entity_id: input_boolean.modo_visitante
    to: 'on'
  action:
  - service: automation.turn_off
    data:
      entity_id:
        - automation.garagem_alarme_off_movimento
        - automation.piscina_alarme_off_movimento
        - automation.notificacao_sensor_alarme_off_s_ninguem
        - automation.notificacao_luzez_on_off
        - automation.notificacao_switch_on_off
  - service: notify.telegramtodos
    data:
      message: 'Modo visitante ativo (Alertas desativado)'

# Desativa modo visitante
- alias: "Modo visitante (OFF)"
  initial_state: true
  trigger:
    platform: state
    entity_id: input_boolean.modo_visitante
    to: 'off'
  action:
  - service: automation.turn_on
    data:
      entity_id:
        - automation.garagem_alarme_off_movimento
        - automation.piscina_alarme_off_movimento
        - automation.notificacao_sensor_alarme_off_s_ninguem
        - automation.notificacao_luzez_on_off
        - automation.notificacao_switch_on_off
  - service: notify.telegramtodos
    data:
      message: 'Modo visitante desativo (Alertas Ativo)'

# Evitar esquecer o modo visitante quando chegar em casa!
- alias: "Desliga o Modo visitante ao chegar em casa"
  initial_state: true
  trigger:
    platform: state
    entity_id:  sensor.donos_em_casa
    to: 'on'
  action:
  - service: input_boolean.turn_off
    data:
      entity_id:
        - input_boolean.modo_visitante

# Não deixa a energia da geladeira ficar desligada (eventula descuido de desligar)
- alias: 'Evita deixar Geladeira desligada'
  initial_state: true
  trigger:
    - platform: state
      entity_id: switch.geladeira
      to: 'off'
      for:
        minutes: 10
  action:
  - service: switch.turn_on
    data:
      entity_id: switch.geladeira
  - service: notify.telegramtodos
    data:
      message: 'Ops, liguei a energia da geladeira para evitar que algo estrague. <i>Se deseja manter desligada sugiro desativar está automação, ou tirar da tomada!</i>'

- alias: "Aviso ao desligar energia da Geladeira"
  initial_state: true
  trigger:
    platform: state
    entity_id: switch.geladeira
    to: 'off'
  action:
  - service: notify.telegramrudi
    data:
      message: 'Energia da geladeira: <b>DESLIGADA</b>!'

- alias: "Aviso ao ligar energia da Geladeira"
  initial_state: true
  trigger:
    platform: state
    entity_id: switch.geladeira
    to: 'on'
  action:
  - service: notify.telegramrudi
    data:
      message: 'Energia da geladeira: <b>LIGADA</b>!'

# Trafego da porta WAN
- alias: "Monitor WAN in"
  trigger:
    platform: state
    entity_id: sensor.ether1_wan_in
  action:
    - service: input_number.set_value
      data_template:
        entity_id: input_number.internet_delta_in
        value: '{{ ((trigger.to_state.state | int - trigger.from_state.state | int) * 8 ) / ( as_timestamp(trigger.to_state.last_updated) - as_timestamp(trigger.from_state.last_updated) ) }}'
- alias: "Monitor WAN out"
  trigger:
    platform: state
    entity_id: sensor.ether1_wan_out
  action:
    - service: input_number.set_value
      data_template:
        entity_id: input_number.internet_delta_out
        value: '{{ ((trigger.to_state.state | int - trigger.from_state.state | int) * 8 ) / ( as_timestamp(trigger.to_state.last_updated) - as_timestamp(trigger.from_state.last_updated) ) }}'


- alias: 'Monitoramento status do motor da Piscina'
  initial_state: false
  trigger:
  - entity_id: 
      - sensor.motor_piscina_status
    from: 'Standby'
    platform: state
    to: 'Ligado'
  - entity_id:
      - sensor.motor_piscina_status
    from: 'Ligado'
    platform: state
    to: 'Standby'
  - entity_id:
      - sensor.motor_piscina_status
    from: 'Desligado'
    platform: state
    to: 'Standby'
  - entity_id:
      - sensor.motor_piscina_status
    from: 'Standby'
    platform: state
    to: 'Desligado'
  - entity_id:
      - sensor.motor_piscina_status
    from: 'Ligado'
    platform: state
    to: 'Desligado'
  action:
  - service: notify.telegramrudi
    data_template:
      message: >
        {{ trigger.to_state.attributes.friendly_name }} : <b>{{ trigger.to_state.state }}</b> <i>Gasto Hoje: R${{ states.sensor.energia_gasta_dia_mp.state }}</i>

# Notificações

- alias: 'Notifica Home Assistant foi iniciado'
  trigger:
    platform: homeassistant
    event: start
  action:
  - service: notify.telegramrudi
    data:
      message: "Home Assistant foi iniciado."
  - service: switch.turn_on
    data:
      entity_id:
        - switch.purificador
        - switch.geladeira


- alias: 'Raspberry temperatura elevada'
  trigger:
    platform: template
    value_template: "{{states('sensor.cpu_temperatura')|float > 50 }}"
    for:
      minutes: 1
  action:
    service: notify.telegramrudi
    data_template:
      message: "Raspbery em {{states('sensor.cpu_temperatura')|int}}°"

# Faltou água 
- alias: 'Notifica caixa dagua nível 95%'
  trigger:
    platform: template
    value_template: "{{states('sensor.caixa_dagua')|float < 96 }}"
    for:
      minutes: 1
  action:
    service: notify.telegramtodos
    data_template:
      message: "Caixa D'agua começou a esvaziar! Nível em {{states('sensor.caixa_dagua')|int}}%, aproximadamente {{states('sensor.caixa_dagua_litros')|int}} litros. Parece que faltou água!"

- alias: 'Notifica caixa dagua nível 25%'
  trigger:
    platform: template
    value_template: "{{states('sensor.caixa_dagua')|float < 25 }}"
    for:
      minutes: 1
  action:
    service: notify.telegramtodos
    data_template:
      message: "Nível da caixa d'agua em {{states('sensor.caixa_dagua')|int}}%, aproximadamente {{states('sensor.caixa_dagua_litros')|int}} litros"

- alias: 'Notifica que voltou a água'
  trigger:
    platform: state
    entity_id: sensor.status_caixa_dagua
    to: 'Enchendo'
    for:
      seconds: 30
  condition:
  - condition: state
    entity_id: sensor.status_abastecimento_agua
    state: 'Faltou'
  action:
    service: notify.telegramtodos
    data_template:
      message: "Abastecimento de água retornou. Nível da caixa d'agua em {{states('sensor.caixa_dagua')|int}}%"

- alias: 'Telegram bot responde: Energia'
  initial_state: true
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: '/agua'
  action:
    - service: notify.telegramrudi
      data_template:
        message: >
          A caixa d'agua está em <code>{{states('sensor.caixa_dagua')}}%</code>, <code>{{states('sensor.caixa_dagua_litros')}} litros</code>. 
          Hoje foram gasto aproximadamente {{states('sensor.agua_gasta_dia')}} litros, um gasto de <code>R$ {{states('sensor.agua_gasta_valor_dia')}}.</code> 
          No mês <code>{{states('sensor.agua_gasta_mes')}} litros</code>, <code>R$ {{states('sensor.agua_gasta_valor_mes')}}</code> 

- alias: 'Telegram bot responde: Água'
  initial_state: true
  trigger:
    platform: event
    event_type: telegram_command
    event_data:
      command: '/energia'
  action:
    - service: notify.telegramrudi
      data_template:
        message: >
          Tensão atual é <code>{{ states('sensor.voltagem') }} volts</code>. No momento a casa está consumindo <code>{{ states('sensor.watts') }} watts</code>.
          Hoje você já gastou <code> R${{ states('sensor.energia_gasta_dia') }}</code>. 
          E no mês <code>R$ {{ states('sensor.gasto_mes') }}</code>.
          

- alias: 'Sem energia'
  trigger:
    platform: template
    value_template: "{{states('sensor.watts')|float < 1 }}"
  action:
    service: notify.telegramrudi
    data_template:
      message: "Faltou energia! Equipamentos alimentado pelo nobreak."

- alias: 'Sem energia por mais de 1h'
  trigger:
    platform: template
    value_template: "{{states('sensor.watts')|float < 1 }}"
    for:
      hours: 1
  action:
    service: notify.telegramtodos
    data_template:
      message: "Sem energia por mais de 1h"

- alias: 'Sem energia por mais de 2h'
  trigger:
    platform: template
    value_template: "{{states('sensor.watts')|float < 1 }}"
    for:
      hours: 2
  action:
    service: notify.telegramtodos
    data_template:
      message: "Sem energia por mais de 2h"

- alias: 'Sem energia por mais de 3h'
  trigger:
    platform: template
    value_template: "{{states('sensor.watts')|float < 1 }}"
    for:
      hours: 3
  action:
    service: notify.telegramtodos
    data_template:
      message: "Sem energia por mais de 3h, recomendo fazer o procedimento de desligamento para evitar corromper o SD."


# PURIFICADOR INVERNO 
- alias: "Desliga Purificador 23:00"
  initial_state: false
  trigger:
    - platform: time
      at: '23:00:00'
  action:
  - service: switch.turn_off
    data:
      entity_id: switch.purificador

- alias: "Liga Purificador 11:00"
  initial_state: false
  trigger:
    - platform: time
      at: '11:00:00'
  action:
  - service: switch.turn_on
    data:
      entity_id: switch.purificador

- alias: "Desliga Purificador 13:30"
  initial_state: false
  trigger:
    - platform: time
      at: '13:30:00'
  action:
  - service: switch.turn_off
    data:
      entity_id: switch.purificador



#  _           _
# | |         | |
# | |     __ _| |__
# | |    / _` | '_ \
# | |___| (_| | |_) |
# |______\__,_|_.__/

#- alias: "99-Liga Garagem 20:30h"
#  initial_state: false
#  trigger:
#    - platform: time
#      at: '20:30:00'
#  condition:
#    condition: time
#    weekday:
#      - mon
#      - tue
#      - wed
#      - thu
#      - fri
#  action:
#  - service: light.turn_on
#    data:
#      entity_id: light.luz_da_garagem

#- alias: "99-Desliga Garagem 5:30h"
#  initial_state: false
#  trigger:
#    - platform: time
#      at: '05:30:00'
#  condition:
#    condition: time
#    weekday:
#      - mon
#      - tue
#      - wed
#      - thu
#      - fri
#  action:
#  - service: light.turn_off
#    data:
#      entity_id: light.luz_da_garagem

# ex.: Não executar se foi executado nos ultimos 2min
#- alias: 'NOME DA AUTOMACAO'
#  initial_state: true
#  trigger:
#   [...]
#  condition:
#    condition: template
#    value_template: '{{ as_timestamp(now()) - as_timestamp(states.automation.nome_da_automacao.attributes.last_triggered) | int > 120 }}'
#  action:
#  - service: 
#    [...]


#- alias: Teste_5
#  initial_state: false
#  trigger:
#  - entity_id: input_boolean.boolean_fake
#    from: 'off'
#    platform: state
#    to: 'on'
#  condition:
#  - condition: state
#    entity_id: sensor.donos_em_casa
#    state: 'on'
#  - condition: state
#    entity_id: alarm_control_panel.alarme_da_casa
#    state: disarmed
#  - condition: time
#    after: '11:40:00'
#    before: '11:50:00'
#
#  condition:
#    condition: and
#    conditions:
#      - condition: time
#        after: '18:30:00'
#        before: '21:00:00'
#      - condition: or
#        conditions:
#          - condition: state
#            entity_id: group.all_devices
#            state: 'not_home'
#          - condition: state
#            entity_id: group.all_devices
#            state: 'unknown'


#  condition:
#    condition: and
#    conditions:
#      - condition: state
#        entity_id: alarm_control_panel.alarme_da_casa
#        state: disarmed
#      - condition: template
#        value_template: '{{ as_timestamp(now()) - as_timestamp(states.automation.piscina_alarme_off_movimento.attributes.last_triggered) | int > 70 }}'
#      - condition: or
#        conditions:
#          - condition: state
#            entity_id: group.all_devices
#            state: 'not_home'
#          - condition: state
#            entity_id: group.all_devices
#            state: 'unknown'

- alias: 'Automacao hora e dia'
  initial_state: true
  trigger:
    platform: time
    at: '00:00:00'
  condition:
    condition: template
    value_template: '{{ now().strftime("%d") == "22" }}'
  action:
    - service: notify.telegramrudi
      data_template:
        message: >
          Gasto no mês <code>R$ {{ states('sensor.gasto_mes') }}</code>.

#  action:
#    service: media_player.turn_off
#    data_template:
#      entity_id: >
#          {% if is_state("input_select.radio_player", "Mansarda") %}
#            media_player.bed_2
#          {%-elif is_state("input_select.radio_player", "Doccia") %}
#            media_player.bed_3
#          {%-elif is_state("input_select.radio_player", "Bed") %}
#            media_player.bed
#          {%-elif is_state("input_select.radio_player", "Bath") %}
#            media_player.bath
#          {%-elif is_state("input_select.radio_player", "Salotto") %}
#            media_player.salotto
#          {%-elif is_state("input_select.radio_player", "Salotto Video") %}
#            media_player.salotto_video
#          {% else %}
#            none
#          {% endif %}
